<?php 

	/**
	 * 
	 */
	class controller_user extends controller_controller
	{
		
		function __construct()
		{
			parent::__construct();
		}

		public function test()
		{
			echo "calling from controller user <br>";
		}

		/**
		 *  getters
		 */

		public function getuserinfo($id)
		{
			$this->db->query("SELECT * FROM users WHERE id_user = :id");
			$this->db->bind(":id", strip_tags($id));

			try {
				return $this->db->single();
			} catch (Exception $e) {
				die($e);
			}
		}

		public function getconnectedinfo()
		{
			$this->db->query("SELECT * FROM users WHERE id_user = :id");
			$this->db->bind(":id", $_SESSION['user']);

			try {
				return $this->db->single();
			} catch (Exception $e) {
				die($e);
			}
		}

		public function login()
		{
			$this->db->query("SELECT * FROM users WHERE username = :username OR email = :email");
			$this->db->bind(":username", strip_tags($_POST['username']));
			$this->db->bind(":email", strip_tags($_POST['username']));

			try {
				$res = $this->db->single();	
			} catch (Exception $e) {
				die($e);
			}

			if (password_verify(strip_tags($_POST['pass']), $res->password)) {
				$_SESSION['user'] = $res->id_user;
				return true;
			}else{
				return false;
			}

		}

		/**
		 *  Setters
		 */

		public function changepassword()
		{
			# code...
		}

		public function changepic()
		{
			# code...
		}

		public function signup()
		{
			if ($_POST['pass1'] === $_POST['pass2']) {
				$this->db->query("INSERT INTO users(username, email, nom, prenom, password, img) VALUES(:username, :email, :nom, :prenom, :pass, :img)");
				$this->db->bind(":username",strip_tags($_POST['username']));
				$this->db->bind(":email",strip_tags($_POST['email']));
				$this->db->bind(":nom",strip_tags($_POST['nom']));
				$this->db->bind(":prenom",strip_tags($_POST['prenom']));
				$this->db->bind(":pass",password_hash(strip_tags($_POST['pass1']), PASSWORD_BCRYPT));
				$this->db->bind(":img","a.jpg");

				try {
					$this->db->execute();
					return true;
				} catch (Exception $e) {
					echo $e;
					return false;
				}

			}else{
				return false;
			}

		}

	}

 ?>