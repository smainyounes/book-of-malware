<?php 

	/**
	 * home view
	 */
	class view_home 
	{
		
		private $post;
		private $category;

		function __construct()
		{
			$this->post = new controller_posts();
			$this->category = new controller_category();
		}

		public function test()
		{
			echo "call view home <br>";
		}

		public function loadpage()
		{

			$data = $this->category->getall();
			if (isset($_GET['categ'])) {
				$posts = $this->post->getbycateg($_GET['categ']);
			}else{
				$posts = $this->post->getall();
			}
			
			?>

			<div class="container" id="page-content">
				<div class="row mb-lg-3 mb-sm-0">
				    <a href="index.php" class="col-lg-3 col-sm-6 py-2">
				      <div class="card card-malware bg-secondary">
				        <div class="card-body">
				          <h5 class="card-title text-center text-white">All</h5>
				        </div>
				      </div>
				    </a>
				    <?php foreach($data as $categ): ?>
				    	<a href="index.php?categ=<?php echo($categ->id_categ) ?>" class="col-lg-3 col-sm-6 py-2">
				    	  <div class="card card-malware bg-secondary">
				    	    <div class="card-body">
				    	      <h5 class="card-title text-center text-white"><?php echo $categ->nom_categ; ?></h5>
				    	    </div>
				    	  </div>
				    	</a>
				    <?php endforeach; ?>
				</div>

				<?php if($posts): ?>
					<table class="table table-striped table-dark">
					    <thead>
					      <tr>
					        <th scope="col">Name</th>
					        <th scope="col">Category</th>
					        <th scope="col">Threat</th>
					        <th scope="col">User</th>
					        <th scope="col">Description</th>
					        <th scope="col">Time</th>
					        <th scope="col">Download</th>
					      </tr>
					    </thead>
					    <tbody>
					      					      
					<?php foreach($posts as $mal): ?>
						<tr>
						  <th scope="row"><?php echo $mal->name_malware; ?></th>
						  <td><?php echo $mal->nom_categ; ?></td>
						  <td><?php echo $mal->threat_lvl; ?></td>
						  <td><a href="profile.php?id=<?php echo($mal->user) ?>"><?php echo $mal->username; ?></a></td>
						  <td><?php echo $mal->description; ?></td>
						  <td><?php echo $mal->date_insert; ?></td>
						  <td><a href="files/<?php echo($mal->filename) ?>" download><?php echo $mal->filename; ?></a></td>
						</tr>
					<?php endforeach; ?>
					    </tbody>
					</table>
				<?php else: ?>
					<div class="h2 text-center text-white">No malware posted yet</div>
				<?php endif; ?>

				
			</div>
			
			<?php
		}

	}


 ?>