<?php 

	/**
	 * 
	 */
	class view_profile
	{
		
		private $post;
		private $category;
		private $user;

		function __construct()
		{
			$this->post = new controller_posts();
			$this->category = new controller_category();
			$this->user = new controller_user();
		}

		public function test()
		{
			echo "calling profile view <br>";
		}

		public function loadpage()
		{
			$userinfo = $this->user->getconnectedinfo();
			$list_categ = $this->category->getall();
			$posts = $this->post->getall();

			?>

			<div class="container" id="page-content">
				<?php if(isset($_GET['msg'])): ?>
					<div class="alert alert-dark alert-dismissible fade show" role="alert">
					  <strong>Success</strong> your malware has been posted 3:)  
					  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
					    <span aria-hidden="true">&times;</span>
					  </button>
					</div>
				<?php endif; ?>
			  <div class="container-fluid text-center p-3">
			    <img src="img/<?php echo($userinfo->img) ?>" class="rounded-circle" width="250px" height="250px">
			    <div class="h3 text-white"><?php echo $userinfo->username; ?></div>
			  </div>
			  	<div class="row mb-lg-3 mb-sm-0">
			  	    <a href="index.php" class="col-lg-3 col-sm-6 py-2">
			  	      <div class="card card-malware bg-secondary">
			  	        <div class="card-body">
			  	          <h5 class="card-title text-center text-white">All</h5>
			  	        </div>
			  	      </div>
			  	    </a>
			  	    <?php foreach($list_categ as $categ): ?>
			  	    	<a href="index.php?categ=<?php echo($categ->id_categ) ?>" class="col-lg-3 col-sm-6 py-2">
			  	    	  <div class="card card-malware bg-secondary">
			  	    	    <div class="card-body">
			  	    	      <h5 class="card-title text-center text-white"><?php echo $categ->nom_categ; ?></h5>
			  	    	    </div>
			  	    	  </div>
			  	    	</a>
			  	    <?php endforeach; ?>
			  	</div>
			  	<?php if($posts): ?>
			  		<table class="table table-striped table-dark">
			  		    <thead>
			  		      <tr>
			  		        <th scope="col">Name</th>
			  		        <th scope="col">Category</th>
			  		        <th scope="col">Threat</th>
			  		        <th scope="col">Description</th>
			  		        <th scope="col">Time</th>
			  		        <th scope="col">Download</th>
			  		        <th scope="col">Delete</th>
			  		      </tr>
			  		    </thead>
			  		    <tbody>
			  		      					      
			  		<?php foreach($posts as $mal): ?>
			  			<tr>
			  			  <th scope="row"><?php echo $mal->name_malware; ?></th>
			  			  <td><?php echo $mal->nom_categ; ?></td>
			  			  <td><?php echo $mal->threat_lvl; ?></td>
			  			  <td><?php echo $mal->description; ?></td>
			  			  <td><?php echo $mal->date_insert; ?></td>
			  			  <td><a href="files/<?php echo($mal->filename) ?>" download><?php echo $mal->filename; ?></a></td>
			  			  <td><button class="btn btn-secondary">Delete</button></td>
			  			</tr>
			  		<?php endforeach; ?>
			  		    </tbody>
			  		</table>
			  	<?php else: ?>
			  		<div class="h2 text-center text-white">No malware posted yet</div>
			  	<?php endif; ?>
			        
			</div>
			
			<?php
		}
	}


 ?>